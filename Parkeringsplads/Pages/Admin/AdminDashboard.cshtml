@page
@model Parkeringsplads.Pages.Admin.AdminDashboardModel
@{
}
<h2>Admin Dashboard</h2>

<!-- Bootstrap Nav Tabs -->
<ul class="nav nav-tabs" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="true">
            Users
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="cars-tab" data-bs-toggle="tab" data-bs-target="#cars" type="button" role="tab" aria-controls="cars" aria-selected="false">
            Cars
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="cities-tab" data-bs-toggle="tab" data-bs-target="#cities" type="button" role="tab" aria-controls="cities" aria-selected="false">
            Cities
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="addresses-tab" data-bs-toggle="tab" data-bs-target="#addresses" type="button" role="tab" aria-controls="addresses" aria-selected="false">
            Addresses
        </button>
    </li>

    <li class="nav-item" role="presentation">
        <button class="nav-link" id="schools-tab" data-bs-toggle="tab" data-bs-target="#schools" type="button" role="tab" aria-controls="schools" aria-selected="false">
            Schools
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="drivers-tab" data-bs-toggle="tab" data-bs-target="#drivers" type="button" role="tab" aria-controls="drivers" aria-selected="false">
            Drivers
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="trips-tab" data-bs-toggle="tab" data-bs-target="#trips" type="button" role="tab" aria-controls="trips" aria-selected="false">
            Trips
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button" role="tab" aria-controls="requests" aria-selected="false">
            Requests
        </button>
    </li>

</ul>

<!-- All tabs -->
<div class="tab-content mt-3" id="adminTabContent">

    <!-- Users Tab -->
    <div class="tab-pane fade show active" id="users" role="tabpanel" aria-labelledby="users-tab">
        <h3>Search Users</h3>

        @if (HttpContext.Session.GetString("IsAdmin") == "true")
        {
            <!-- Admin can select a user from the list -->
            <div class="form-group">
                <label for="UserSelect">Select User to Edit</label>
                <select id="UserSelect" class="form-control" asp-for="User.UserId" asp-items="Model.Users">
                    <option value="">Select a user</option>
                    @foreach (var user in Model.Users)
                    {
                        <option value="@user.UserId">@user.FirstName @user.LastName</option>
                    }
                </select>
            </div>
        }
        else
        {
            <!-- Regular user will see only their own profile information -->
            <h3>Edit Your Profile</h3>
        }


        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="SearchTerm" placeholder="Search users..." value="@Model.SearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Users != null && Model.Users.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>UserId</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Title</th>
                        <th>School</th>
                        <th>Edit</th>
                        <th>Delete</th>

                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in Model.Users)
                    {
                        <tr>
                            <td>@user.UserId</td>
                            <td>@user.FirstName</td>
                            <td>@user.LastName</td>
                            <td>@user.Email</td>
                            <td>@user.Phone</td>
                            <td>@user.Title</td>
                            <td>@user.School?.SchoolName</td>
                            <td>
                                <a asp-page="/UserPages/UpdateUser" asp-route-userId="@user.UserId" class="text-warning me-2"
                                   onclick="return confirm('Are you sure you want to edit this user?');" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            <td>
                                <form method="post" asp-page-handler="DeleteUser" asp-route-userId="@user.UserId"
                                      onsubmit="return confirm('Are you sure you want to delete this user?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No users found.</p>
        }
    </div>

    <!-- Cars Tab -->
    <div class="tab-pane fade" id="cars" role="tabpanel" aria-labelledby="cars-tab">
        <h3>Search Cars</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="CarSearchTerm" placeholder="Search cars..." value="@Model.CarSearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Cars != null && Model.Cars.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Car Id</th>
                        <th>Model</th>
                        <th>Plate</th>
                        <th>Capacity</th>
                        <th>Driver Id</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var car in Model.Cars)
                    {
                        <tr>
                            <td>@car.CarId</td>
                            <td>@car.CarModel</td>
                            <td>@car.CarPlate</td>
                            <td>@car.CarCapacity</td>
                            <td>@car.DriverId</td>
                            <td>
                                <a asp-page="/CarPages/CarEdit" asp-route-carId="@car.CarId" title="Edit"
                                   onclick="return confirm('Are you sure you want to edit this car?');" class="text-warning me-2">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            <td>
                                <form method="post" asp-page-handler="DeleteCar" asp-route-carId="@car.CarId" onsubmit="return confirm('Are you sure you want to delete this car?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No cars found.</p>
        }
    </div>

    <!-- Cities Tab -->
    <div class="tab-pane fade" id="cities" role="tabpanel" aria-labelledby="cities-tab">
        <h3>Search Cities</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="CitySearchTerm" placeholder="Search cities..." value="@Model.CitySearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Cities != null && Model.Cities.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>City Id</th>
                        <th>City Name</th>
                        <th>Postal Code</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var city in Model.Cities)
                    {
                        <tr>
                            <td>@city.CityId</td>
                            <td>@city.CityName</td>
                            <td>@city.PostalCode</td>
                            <td>
                                <a asp-page="/CityPages/CityEdit" asp-route-cityId="@city.CityId" class="text-warning me-2"
                                   onclick="return confirm('Are you sure you want to edit this city?');" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            <td>
                                <form method="post" asp-page-handler="DeleteCity" asp-route-cityId="@city.CityId"
                                      onsubmit="return confirm('Are you sure you want to delete this city?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No cities found.</p>
        }
    </div>

    <!-- Addresses Tab -->
    <div class="tab-pane fade" id="addresses" role="tabpanel" aria-labelledby="addresses-tab">
        <h3>Search Addresses</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="AddressSearchTerm" placeholder="Search addresses..." value="@Model.AddressSearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Addresses != null && Model.Addresses.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Address Id</th>
                        <th>Road</th>
                        <th>Number</th>
                        <th>City</th>
                        <th>Postal Code</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var address in Model.Addresses)
                    {
                        <tr>
                            <td>@address.AddressId</td>
                            <td>@address.AddressRoad</td>
                            <td>@address.AddressNumber</td>
                            <td>@address.City.CityName</td>
                            <td>@address.City.PostalCode</td>
                            <td>
                                <a asp-page="/AddressPages/AddressEdit" asp-route-addressId="@address.AddressId" class="text-warning me-2"
                                   onclick="return confirm('Are you sure you want to edit this address?');" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            <td>
                                <form method="post" asp-page-handler="DeleteAddress" asp-route-addressId="@address.AddressId"
                                      onsubmit="return confirm('Are you sure you want to delete this address?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No addresses found.</p>
        }
    </div>

    <!-- Schools Tab -->
    <div class="tab-pane fade" id="schools" role="tabpanel" aria-labelledby="schools-tab">
        <h3>Search Schools</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="SchoolSearchTerm" placeholder="Search schools..." value="@Model.SchoolSearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Schools != null && Model.Schools.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>School Id</th>
                        <th>School Name</th>
                        <th>Street</th>
                        <th>Number</th>
                        <th>City</th>
                        <th>Postal Code</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var school in Model.Schools)
                    {
                        <tr>
                            <td>@school.SchoolId</td>
                            <td>@school.SchoolName</td>
                            <td>@school.Address.AddressRoad</td>
                            <td>@school.Address.AddressNumber</td>
                            <td>@school.Address.City.CityName</td>
                            <td>@school.Address.City.PostalCode</td>
                            <td>
                                <a asp-page="/SchoolPages/SchoolEdit" asp-route-schoolId="@school.SchoolId" class="text-warning me-2"
                                   onclick="return confirm('Are you sure you want to edit this school?');" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            <td>
                                <form method="post" asp-page-handler="DeleteSchool" asp-route-schoolId="@school.SchoolId"
                                      onsubmit="return confirm('Are you sure you want to delete this school?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No schools found.</p>
        }
    </div>

    <!-- Drivers Tab -->
    <div class="tab-pane fade" id="drivers" role="tabpanel" aria-labelledby="drivers-tab">
        <h3>Search Drivers</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="DriverSearchTerm" placeholder="Search drivers..." value="@Model.DriverSearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Drivers != null && Model.Drivers.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Driver Id</th>
                        <th>License</th>
                        <th>CPR</th>
                        <th>User Name</th>
                        <th>Email</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var driver in Model.Drivers)
                    {
                        <tr>
                            <td>@driver.DriverId</td>
                            <td>@driver.DriverLicense</td>
                            <td>@driver.DriverCpr</td>
                            <td>@driver.User.FirstName @driver.User.LastName</td>
                            <td>@driver.User.Email</td>
                            <td>
                                <a asp-page="/DriverPages/DriverEdit" asp-route-driverId="@driver.DriverId" class="text-warning me-2"
                                   onclick="return confirm('Are you sure you want to edit this driver?');" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            <td>
                                <form method="post" asp-page-handler="DeleteDriver" asp-route-driverId="@driver.DriverId"
                                      onsubmit="return confirm('Are you sure you want to delete this driver?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No drivers found.</p>
        }
    </div>

    <!-- Trips Tab -->
    <div class="tab-pane fade" id="trips" role="tabpanel" aria-labelledby="trips-tab">
        <h3>Search Trips</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="TripSearchTerm" placeholder="Search trips..." value="@Model.TripSearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Trips != null && Model.Trips.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Trip Id</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Seats</th>
                        <th>Driver</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var trip in Model.Trips)
                    {
                        <tr>
                            <td>@trip.TripId</td>
                            <td>@trip.FromDestination</td>
                            <td>@trip.ToDestination</td>
                            <td>@trip.TripDate.ToShortDateString()</td>
                            <td>@trip.TripTime</td>
                            <td>@trip.TripSeats</td>
                            <td>@trip.Car.Driver.User.FirstName @trip.Car.Driver.User.LastName</td>
                            <td>
                                <form method="post" asp-page-handler="DeleteTrip" asp-route-tripId="@trip.TripId"
                                      onsubmit="return confirm('Are you sure you want to delete this trip?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No trips found.</p>
        }
    </div>

    <!-- Requests Tab -->
    <div class="tab-pane fade" id="requests" role="tabpanel" aria-labelledby="requests-tab">
        <h3>Search Requests</h3>

        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="RequestSearchTerm" placeholder="Search requests..." value="@Model.RequestSearchTerm" />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </form>

        @if (Model.Requests != null && Model.Requests.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Request Id</th>
                        <th>Status</th>
                        <th>Time</th>
                        <th>Address</th>
                        <th>Message</th>
                        <th>User</th>
                        <th>Trip (From → To)</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var request in Model.Requests)
                    {
                        <tr>
                            <td>@request.RequestId</td>
                            <td>@(request.RequestStatus.HasValue?(request.RequestStatus.Value ? "Accepted" : "Declined") : "Pending")</td>
                            <td>@request.RequestTime</td>
                            <td>@request.RequestAddress</td>
                            <td>@request.RequestMessage</td>
                            <td>@(request.Users != null ? request.Users.FirstName + " " + request.Users.LastName : "N/A")</td>
                            <td>@request.Trip.FromDestination → @request.Trip.ToDestination</td>
                            <td>
                                <form method="post" asp-page-handler="DeleteRequest" asp-route-requestId="@request.RequestId"
                                      onsubmit="return confirm('Are you sure you want to delete this request?');">
                                    <button type="submit" class="btn btn-link p-0" title="Delete">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No requests found.</p>
        }
    </div>


</div>