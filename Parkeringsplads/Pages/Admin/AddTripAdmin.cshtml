@page
@model Parkeringsplads.Pages.Admin.AddTripAdminModel
@{
    ViewData["Title"] = "Opret tur for Admin";
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}


@if (!string.IsNullOrEmpty(Model.SuccessMessage))
{
    <div class="alert alert-success">@Model.SuccessMessage</div>
}
@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}

<h2>Opret tur for Admin</h2>

@if (Model.Driver != null)
{
    <div class="mb-4">
        <label class="form-label">Chauffør</label>
        <input type="text" class="form-control" value="@Model.Driver.User.FirstName @Model.Driver.User.LastName" readonly />
    </div>
}

<!-- Bilvalg -->
<form method="get" class="mb-4">
    <input type="hidden" name="handler" value="SelectCar" />
    <input type="hidden" name="selectedDriverId" value="@Model.SelectedDriverId" />
    <label asp-for="SelectedCarId" class="form-label">Vælg bil</label>
    <select asp-for="SelectedCarId" class="form-control" asp-items="@(new SelectList(Model.Cars, "CarId", "CarModel"))" onchange="this.form.submit()">
        <option value="">Vælg en bil</option>
    </select>
</form>

<!-- Adressevalg -->
<form method="get" class="mb-4">
    <input type="hidden" name="handler" value="SelectAddress" />
    <input type="hidden" name="selectedCarId" value="@Model.SelectedCarId" />
    <input type="hidden" name="selectedDriverId" value="@Model.SelectedDriverId" />
    <input type="hidden" name="direction" value="@Model.Direction" />

    <label class="form-label">Adresse</label>

    <!-- Dropdown -->
    <select class="form-control mb-2" name="selectedAddress" onchange="this.form.submit()" @(Model.UseCustomAddress ? "disabled" : "")>
        <option value="">Vælg en adresse</option>
        @foreach (var addr in Model.UserAddresses)
        {
            <option value="@addr" selected="@(addr == Model.SelectedAddress ? "selected" : null)">
                @addr
            </option>
        }
    </select>

    <!-- Checkbox to toggle custom address -->
    <div class="form-check">
        <input class="form-check-input" type="checkbox" id="useCustomAddress" name="useCustomAddress" value="true"
               onchange="this.form.submit()" @(Model.UseCustomAddress ? "checked" : "") />
        <label class="form-check-label" for="useCustomAddress">Indtast selv adresse</label>
    </div>

    <!-- Custom address input -->
    <input class="form-control mt-2" type="text" name="customAddress" placeholder="Egen adresse"
           value="@Model.CustomAddress" @(Model.UseCustomAddress ? "" : "disabled") />
</form>

@if (!string.IsNullOrWhiteSpace(Model.Trip.FromDestination))
{
    <div class="mb-3">
        <label>Fra</label>
        <input type="text" class="form-control" value="@Model.Trip.FromDestination" readonly />
    </div>
}
@if (!string.IsNullOrWhiteSpace(Model.Trip.ToDestination))
{
    <div class="mb-3">
        <label>Til</label>
        <input type="text" class="form-control" value="@Model.Trip.ToDestination" readonly />
    </div>
}

<form method="post">
    <input type="hidden" asp-for="Direction" />
    <input type="hidden" asp-for="SelectedCarId" />
    <input type="hidden" asp-for="SelectedAddress" />
    <input type="hidden" asp-for="CustomAddress" />
    <input type="hidden" asp-for="UseCustomAddress" />
    <input type="hidden" asp-for="SelectedDriverId" />

    <div class="mb-3">
        <label asp-for="Trip.TripDate">Dato</label>
        <input asp-for="Trip.TripDate" type="date" class="form-control" min="@DateTime.Today.ToString("yyyy-MM-dd")" />
        <span asp-validation-for="Trip.TripDate" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Trip.TripTime">Tidspunkt</label>
        <input asp-for="Trip.TripTime" type="time" class="form-control" />
        <span asp-validation-for="Trip.TripTime" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Trip.TripSeats">Antal passagersæder</label>
        <select asp-for="Trip.TripSeats" class="form-control" asp-items="@(new SelectList(Model.SeatOptions))">
            <option value="">Vælg antal</option>
        </select>
        <span asp-validation-for="Trip.TripSeats" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-primary">Opret tur</button>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
